machine:
  java:
    # Use JDK 8 because it has perm inside of normal heap, making setting memory limits easier.
    # Oracle version, since OpenJdk is currently not avalabile in version 8 on CircleCi.
    version: oraclejdk8
  environment:
    GRADLE_OPTS: "-Xmx2g"
    _JAVA_OPTIONS: "-Xms256m -Xmx1536m"
    CIRCLE_JDK_VERSION: oraclejdk8
    TERM: "dumb"
    ADB_INSTALL_TIMEOUT: "10"
  post:
    # Turn off unneded services to free memory.
    - for service in {"apache2","beanstalkd","cassandra","couchbase-server","couchdb","docker","elasticsearch","memcached","mongodb","mysql","neo4j-service","postgresql","puppet","redis-server","riak","solr","sphinxsearch","zookeeper"}; do sudo service $service stop; done


dependencies:
  pre:
    - echo y | android update sdk --no-ui --all --filter tool,extra-android-m2repository,extra-android-support,android-23
    - echo y | android update sdk --no-ui --all --filter build-tools-23.0.2
  override:
    - ./gradlew dependencies

test:
  override:
    # Test building of all debug flavours and run unit tests.
    - ./gradlew assembleDebug check -PdisablePreDex

    # copy the build outputs to artifacts
    - cp -r app/build/outputs $CIRCLE_ARTIFACTS
    # copy the test results to the test results directory.
    - cp -r app/build/reports $CIRCLE_TEST_REPORTS
